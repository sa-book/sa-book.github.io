---
title: "Sequence length and granularity"
description: |
  Chapter 2.2 Defining sequences
output: distill::distill_article    
---

```{r setup, include=FALSE}
# Load required packages
library(here)
source(here("source", "load_libraries.R"))

# Output options
knitr::opts_chunk$set(eval=TRUE, echo=TRUE)
options("kableExtra.html.bsTable" = T)

# load data for Chapter 2
load(here("data", "2-0_ChapterSetup.RData"))

```

```{r, xaringanExtra-clipboard, echo=FALSE}
htmltools::tagList(
  xaringanExtra::use_clipboard(
    button_text = "<i class=\"fa fa-clone fa-2x\" style=\"color: #301e64\"></i>",
    success_text = "<i class=\"fa fa-check fa-2x\" style=\"color: #90BE6D\"></i>",
    error_text = "<i class=\"fa fa-times fa-2x\" style=\"color: #F94144\"></i>"
  ),
  rmarkdown::html_dependency_font_awesome()
)
```

<details><summary>**Click here to get instructions...**</summary>

- Please download and unzip the replication files for Chapter 2
([`r fontawesome::fa("far fa-file-zipper")` Chapter02.zip](source/Chapter02.zip)). 
- Read `readme.html` and run `2-0_ChapterSetup.R`. This will create `2-0_ChapterSetup.RData` in the sub folder `data/R`. This file contains the data required to produce the table shown at the bottom of this page. 
- We also recommend to load the libraries listed in the Chapter 2's `LoadInstallPackages.R`

```{r, eval=FALSE}
# assuming you are working within .Rproj environment
library(here)

# install (if necessary) and load other required packages
source(here("source", "load_libraries.R"))

# load environment generated in "2-0_ChapterSetup.R"
load(here("data", "R", "2-0_ChapterSetup.RData"))

```
</details>

\

**Table 2.2** in Chapter 2.2 compares different approaches towards defining sequence data.

The sequences consist of monthly information on respondents' partnership status between age 18 to 40 (monthly data). The sequences are stored in the object `partner.month.seq` and distinguish four states:

```{r echo=FALSE}
tibble(State = longlab.partner, 
       `Short Label` = shortlab.partner) %>% 
kable() %>%
  kable_styling(bootstrap_options = c("responsive", "hover", "condensed"),
                full_width = F)
```


In addition to using the original data, two alternative approaches of defining the sequences are discussed:

-   The first alternative aims at reducing the complexity of the original data by imposing a threshold rule that defines a minimum length for partnership spells. If a spell falls below this threshold value, it would be discounted and the respective states coded as being single rather than in a relationship. The sequence object based on this manipulated data set is stored in `partner.month.seq2` which was created in the same way as `partner.month.seq` (see [Chapter 2-1](rChapter2-1.html) or `2-0_ChapterSetup.R`).
-   The second strategy changes the granularity of the sequence data from monthly to yearly. That is, twelve states from the original sequence are condensed to one state in the new sequence by applying the `seqgranularity` function from the [`{TraMineRExtras}`](http://traminer.unige.ch){target="_blank"} package. The resulting object (already stored in `2-0_ChapterSetup.RData`) was created with the following code

```{r, eval=FALSE}
# change granularity --> years instead of months (using modal values)
partner.year.seq <- seqgranularity(partner.month.seq, 
                               tspan=12, method="mostfreq")
```

Now we can produce **Table 2.2** from the book which shows a small selection of four sequences using the three different specifications.


```{r, eval=TRUE,results='hide'}

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Table 2.2 - Different alternatives of defining sequences ----
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

# Using original Sequence data (monthly granularity) (column 1)
col1 <- print(partner.month.seq[c(4, 8, 16, 21), ], format = "SPS")

# Using recoded monthly data only considering
# spells lasting at least 12 months (column 2)
col2 <- print(partner.month.seq2[c(4, 8, 16, 21), ], format = "SPS")

# Using sequences with yearly granularity (Column 3)
col3 <- print(partner.year.seq[c(4, 8, 16, 21), ], format = "SPS")
```

```{r, include=FALSE}
# Using original Sequence data (monthly granularity) (column 1)
col1 <- print(partner.month.seq[c(4, 8, 16, 21), ], format = "SPS")

# Using recoded monthly data only considering
# spells lasting at least 12 months (column 2)
col2 <- print(partner.month.seq2[c(4, 8, 16, 21), ], format = "SPS")

# Using sequences with yearly granularity (Column 3)
col3 <- print(partner.year.seq[c(4, 8, 16, 21), ], format = "SPS")

```

```{r, layout="l-page"}
# Print selection of sequences from differently specified sequence data
tibble(col1, col2, col3) %>%
  kable(col.names = c("Original sequence", 
                      "Strategy 1 – recode", 
                      "Strategy 2 – aggregate")) %>%
  kable_styling(bootstrap_options = 
                  c("striped", "hover", "condensed", "responsive"))

```

